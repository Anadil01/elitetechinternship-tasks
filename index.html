<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShopPWA - Your Offline Store</title>
    <meta name="description" content="Modern e-commerce platform with offline capabilities">
    <meta name="theme-color" content="#2563eb">
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiU2hvcFBXQSIsInNob3J0X25hbWUiOiJTaG9wUFdBIiwiZGVzY3JpcHRpb24iOiJNb2Rlcm4gZS1jb21tZXJjZSBwbGF0Zm9ybSB3aXRoIG9mZmxpbmUgY2FwYWJpbGl0aWVzIiwic3RhcnRfdXJsIjoiLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiNmZmZmZmYiLCJ0aGVtZV9jb2xvciI6IiMyNTYzZWIiLCJpY29ucyI6W3sic3JjIjoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTkRnaUlHaGxhV2RvZEQwaU5EZ2lJSFpwWlhkQ2IzZzlJakFnTUNBME9DQTBPQ0lnWm1sc2JEMGlJakl6TmpObFlpSStQSEpsWTNRZ2VEMGlOQ0lnZVQwaU5DSWdkMmxrZEdnOUlqUXdJaUJvWldsbmFIUTlJalF3SWlCeWVEMGlOQ0lnWm1sc2JEMGlJakUxTVRVeE9TSSs4L3JsWTNRK1BDOXpkbWMrIiwic2l6ZXMiOiI0OHg0OCIsInR5cGUiOiJpbWFnZS9zdmcreG1sIn1dfQ==">
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgZmlsbD0iIzI1NjNlYiI+PHJlY3QgeD0iNCIgeT0iNCIgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iNCIgZmlsbD0iIzE1MTUxOSIvPjwvc3ZnPg==">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .cart-icon {
            position: relative;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 0.5rem;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cart-icon:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .cart-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Status Bar */
        .status-bar {
            background: #10b981;
            color: white;
            padding: 0.5rem 1rem;
            text-align: center;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .status-bar.offline {
            background: #f59e0b;
        }

        /* Search Bar */
        .search-container {
            padding: 1rem;
            background: #f8fafc;
        }

        .search-bar {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 25px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-bar:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* Categories */
        .categories {
            padding: 1rem;
            background: white;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .category-card {
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .category-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-color: #2563eb;
        }

        .category-card.active {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
        }

        /* Products Grid */
        .products-section {
            padding: 1rem;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .product-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 1px solid #e5e7eb;
        }

        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .product-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: #6b7280;
        }

        .product-info {
            padding: 1rem;
        }

        .product-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #1f2937;
        }

        .product-price {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2563eb;
            margin-bottom: 0.5rem;
        }

        .product-description {
            color: #6b7280;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .add-to-cart {
            width: 100%;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 0.75rem;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .add-to-cart:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-1px);
        }

        .add-to-cart:active {
            transform: translateY(0);
        }

        /* Cart Modal */
        .cart-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .cart-modal.active {
            display: flex;
        }

        .cart-content {
            background: white;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .cart-header {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-items {
            padding: 1rem;
        }

        .cart-item {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 0.5rem;
            border-radius: 8px;
            background: #f8fafc;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .quantity-btn {
            background: #2563eb;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cart-total {
            padding: 1rem;
            border-top: 1px solid #e5e7eb;
            background: #f8fafc;
        }

        .checkout-btn {
            width: 100%;
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 1rem;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 1rem;
            border-radius: 8px;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1001;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: #ef4444;
        }

        /* Loading Spinner */
        .loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1002;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f4f6;
            border-top: 4px solid #2563eb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 1rem;
            }

            .category-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 0.5rem;
            }

            .cart-content {
                width: 95%;
            }
        }

        @media (max-width: 480px) {
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            .category-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    🛍️ ShopPWA
                </div>
                <button class="cart-icon" onclick="toggleCart()">
                    🛒
                    <span class="cart-badge" id="cartBadge">0</span>
                </button>
            </div>
        </header>

        <!-- Status Bar -->
        <div class="status-bar" id="statusBar">
            ✅ Online - All features available
        </div>

        <!-- Search Bar -->
        <div class="search-container">
            <input type="text" class="search-bar" placeholder="Search products..." id="searchInput">
        </div>

        <!-- Categories -->
        <section class="categories">
            <h2>Categories</h2>
            <div class="category-grid" id="categoryGrid">
                <!-- Categories will be populated by JavaScript -->
            </div>
        </section>

        <!-- Products -->
        <section class="products-section">
            <h2>Products</h2>
            <div class="products-grid" id="productsGrid">
                <!-- Products will be populated by JavaScript -->
            </div>
        </section>

        <!-- Cart Modal -->
        <div class="cart-modal" id="cartModal">
            <div class="cart-content">
                <div class="cart-header">
                    <h3>Shopping Cart</h3>
                    <button onclick="toggleCart()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">×</button>
                </div>
                <div class="cart-items" id="cartItems">
                    <!-- Cart items will be populated by JavaScript -->
                </div>
                <div class="cart-total">
                    <div style="font-size: 1.2rem; font-weight: bold; margin-bottom: 0.5rem;">
                        Total: $<span id="cartTotal">0.00</span>
                    </div>
                    <button class="checkout-btn" onclick="checkout()">Checkout</button>
                </div>
            </div>
        </div>

        <!-- Notification -->
        <div class="notification" id="notification"></div>

        <!-- Loading Spinner -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
        </div>
    </div>

    <script>
        // PWA App State
        let cart = [];
        let products = [];
        let categories = [];
        let isOnline = navigator.onLine;
        let currentCategory = 'all';

        // Sample Data
        const sampleProducts = [
            {
                id: 1,
                name: "Wireless Headphones",
                price: 79.99,
                description: "Premium wireless headphones with noise cancellation",
                category: "electronics",
                image: "🎧"
            },
            {
                id: 2,
                name: "Smart Watch",
                price: 199.99,
                description: "Fitness tracking smartwatch with heart rate monitor",
                category: "electronics",
                image: "⌚"
            },
            {
                id: 3,
                name: "Coffee Maker",
                price: 89.99,
                description: "Programmable coffee maker with built-in grinder",
                category: "home",
                image: "☕"
            },
            {
                id: 4,
                name: "Running Shoes",
                price: 129.99,
                description: "Lightweight running shoes with cushioned sole",
                category: "sports",
                image: "👟"
            },
            {
                id: 5,
                name: "Tablet",
                price: 299.99,
                description: "10-inch tablet with high-resolution display",
                category: "electronics",
                image: "📱"
            },
            {
                id: 6,
                name: "Yoga Mat",
                price: 39.99,
                description: "Non-slip yoga mat for home workouts",
                category: "sports",
                image: "🧘"
            }
        ];

        const sampleCategories = [
            { id: 'all', name: 'All Products', icon: '📦' },
            { id: 'electronics', name: 'Electronics', icon: '💻' },
            { id: 'home', name: 'Home & Garden', icon: '🏠' },
            { id: 'sports', name: 'Sports', icon: '⚽' }
        ];

        // Initialize App
        function initApp() {
            // Load data (from cache or samples)
            loadData();
            
            // Render UI
            renderCategories();
            renderProducts();
            updateCartUI();
            
            // Setup event listeners
            setupEventListeners();
            
            // Register service worker
            registerServiceWorker();
            
            // Setup push notifications
            setupPushNotifications();
            
            // Update online status
            updateOnlineStatus();
        }

        // Load Data
        function loadData() {
            try {
                // Try to load from cache/localStorage (simulated)
                const cachedProducts = getCachedData('products');
                const cachedCategories = getCachedData('categories');
                const cachedCart = getCachedData('cart');
                
                products = cachedProducts || sampleProducts;
                categories = cachedCategories || sampleCategories;
                cart = cachedCart || [];
                
                // Cache the data
                cacheData('products', products);
                cacheData('categories', categories);
                cacheData('cart', cart);
            } catch (error) {
                console.error('Error loading data:', error);
                // Fallback to sample data
                products = sampleProducts;
                categories = sampleCategories;
                cart = [];
            }
        }

        // Cache Data (simulated with variables since localStorage is not available)
        let dataCache = {};
        
        function cacheData(key, data) {
            dataCache[key] = JSON.stringify(data);
        }
        
        function getCachedData(key) {
            try {
                return JSON.parse(dataCache[key] || 'null');
            } catch {
                return null;
            }
        }

        // Render Categories
        function renderCategories() {
            const categoryGrid = document.getElementById('categoryGrid');
            categoryGrid.innerHTML = '';
            
            categories.forEach(category => {
                const categoryCard = document.createElement('div');
                categoryCard.className = `category-card ${currentCategory === category.id ? 'active' : ''}`;
                categoryCard.innerHTML = `
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">${category.icon}</div>
                    <div>${category.name}</div>
                `;
                categoryCard.onclick = () => filterByCategory(category.id);
                categoryGrid.appendChild(categoryCard);
            });
        }

        // Render Products
        function renderProducts() {
            const productsGrid = document.getElementById('productsGrid');
            productsGrid.innerHTML = '';
            
            let filteredProducts = products;
            
            // Filter by category
            if (currentCategory !== 'all') {
                filteredProducts = products.filter(product => product.category === currentCategory);
            }
            
            // Filter by search
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm) {
                filteredProducts = filteredProducts.filter(product => 
                    product.name.toLowerCase().includes(searchTerm) ||
                    product.description.toLowerCase().includes(searchTerm)
                );
            }
            
            filteredProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <div class="product-image">${product.image}</div>
                    <div class="product-info">
                        <div class="product-title">${product.name}</div>
                        <div class="product-price">$${product.price.toFixed(2)}</div>
                        <div class="product-description">${product.description}</div>
                        <button class="add-to-cart" onclick="addToCart(${product.id})">
                            Add to Cart
                        </button>
                    </div>
                `;
                productsGrid.appendChild(productCard);
            });
        }

        // Filter by Category
        function filterByCategory(categoryId) {
            currentCategory = categoryId;
            renderCategories();
            renderProducts();
        }

        // Add to Cart
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            const existingItem = cart.find(item => item.id === productId);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    ...product,
                    quantity: 1
                });
            }
            
            // Cache cart
            cacheData('cart', cart);
            
            // Update UI
            updateCartUI();
            
            // Show notification
            showNotification(`${product.name} added to cart!`);
            
            // Send push notification if supported
            if (isOnline) {
                sendPushNotification('Item Added', `${product.name} has been added to your cart`);
            }
        }

        // Update Cart UI
        function updateCartUI() {
            const cartBadge = document.getElementById('cartBadge');
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');
            
            // Update badge
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartBadge.textContent = totalItems;
            
            // Update cart items
            cartItems.innerHTML = '';
            let total = 0;
            
            cart.forEach(item => {
                total += item.price * item.quantity;
                
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div style="font-size: 2rem;">${item.image}</div>
                    <div class="cart-item-info">
                        <div style="font-weight: 600;">${item.name}</div>
                        <div style="color: #2563eb;">$${item.price.toFixed(2)} each</div>
                    </div>
                    <div class="cart-item-controls">
                        <button class="quantity-btn" onclick="updateQuantity(${item.id}, -1)">-</button>
                        <span style="margin: 0 0.5rem;">${item.quantity}</span>
                        <button class="quantity-btn" onclick="updateQuantity(${item.id}, 1)">+</button>
                    </div>
                `;
                cartItems.appendChild(cartItem);
            });
            
            cartTotal.textContent = total.toFixed(2);
        }

        // Update Quantity
        function updateQuantity(productId, change) {
            const item = cart.find(item => item.id === productId);
            if (!item) return;
            
            item.quantity += change;
            
            if (item.quantity <= 0) {
                cart = cart.filter(item => item.id !== productId);
            }
            
            // Cache cart
            cacheData('cart', cart);
            
            // Update UI
            updateCartUI();
        }

        // Toggle Cart
        function toggleCart() {
            const cartModal = document.getElementById('cartModal');
            cartModal.classList.toggle('active');
        }

        // Checkout
        function checkout() {
            if (cart.length === 0) {
                showNotification('Your cart is empty!', 'error');
                return;
            }
            
            // Simulate checkout process
            showLoading();
            
            setTimeout(() => {
                hideLoading();
                cart = [];
                cacheData('cart', cart);
                updateCartUI();
                toggleCart();
                showNotification('Order placed successfully! 🎉');
                
                // Send push notification
                if (isOnline) {
                    sendPushNotification('Order Confirmed', 'Your order has been placed successfully!');
                }
            }, 2000);
        }

        // Show Notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Show/Hide Loading
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }
        
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Search functionality
            document.getElementById('searchInput').addEventListener('input', () => {
                renderProducts();
            });
            
            // Online/offline events
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
            
            // Close cart when clicking outside
            document.getElementById('cartModal').addEventListener('click', (e) => {
                if (e.target.id === 'cartModal') {
                    toggleCart();
                }
            });
        }

        // Update Online Status
        function updateOnlineStatus() {
            isOnline = navigator.onLine;
            const statusBar = document.getElementById('statusBar');
            
            if (isOnline) {
                statusBar.textContent = '✅ Online - All features available';
                statusBar.className = 'status-bar';
            } else {
                statusBar.textContent = '⚠️ Offline - Using cached data';
                statusBar.className = 'status-bar offline';
            }
        }

        // Service Worker Registration
        async function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                try {
                    // Create service worker as data URL
                    const swCode = `
                        const CACHE_NAME = 'shoppwa-v1';
                        const urlsToCache = [
                            '/',
                            '/offline.html'
                        ];

                        self.addEventListener('install', (event) => {
                            event.waitUntil(
                                caches.open(CACHE_NAME)
                                    .then((cache) => {
                                        return cache.addAll(urlsToCache);
                                    })
                            );
                        });

                        self.addEventListener('fetch', (event) => {
                            event.respondWith(
                                caches.match(event.request)
                                    .then((response) => {
                                        if (response) {
                                            return response;
                                        }
                                        return fetch(event.request);
                                    })
                                    .catch(() => {
                                        return caches.match('/offline.html');
                                    })
                            );
                        });
                    `;
                    
                    const swBlob = new Blob([swCode], { type: 'application/javascript' });
                    const swUrl = URL.createObjectURL(swBlob);
                    
                    const registration = await navigator.serviceWorker.register(swUrl);
                    console.log('Service Worker registered successfully:', registration);
                } catch (error) {
                    console.log('Service Worker registration failed:', error);
                }
            }
        }

        // Push Notifications Setup
        async function setupPushNotifications() {
            if ('Notification' in window && 'serviceWorker' in navigator) {
                // Request permission
                const permission = await Notification.requestPermission();
                if (permission === 'granted') {
                    console.log('Push notifications enabled');
                }
            }
        }

        // Send Push Notification
        function sendPushNotification(title, body) {
            if ('Notification' in window && Notification.permission === 'granted') {
                const notification = new Notification(title, {
                    body: body,
                    icon: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgZmlsbD0iIzI1NjNlYiI+PHJlY3QgeD0iNCIgeT0iNCIgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iNCIgZmlsbD0iIzE1MTUxOSIvPjwvc3ZnPg==',
                    badge: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgZmlsbD0iIzI1NjNlYiI+PHJlY3QgeD0iNCIgeT0iNCIgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iNCIgZmlsbD0iIzE1MTUxOSIvPjwvc3ZnPg==',
                    tag: 'ecommerce-notification',
                    requireInteraction: false,
                    silent: false
                });
                
                // Auto close after 5 seconds
                setTimeout(() => {
                    notification.close();
                }, 5000);
                
                // Handle notification click
                notification.onclick = function() {
                    window.focus();
                    notification.close();
                };
            }
        }

        // Sync Data (Background Sync Simulation)
        function syncData() {
            if (isOnline) {
                // Simulate API calls to sync data
                console.log('Syncing data with server...');
                
                // In a real app, you would:
                // 1. Send pending orders to server
                // 2. Fetch updated product data
                // 3. Update cached data
                
                showNotification('Data synchronized!');
            }
        }

        // Background Sync Setup
        function setupBackgroundSync() {
            if ('serviceWorker' in navigator && 'sync' in window.ServiceWorkerRegistration.prototype) {
                navigator.serviceWorker.ready.then((registration) => {
                    // Register background sync
                    registration.sync.register('background-sync').catch(console.error);
                });
            }
        }

        // Handle Install Prompt
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            showInstallPrompt();
        });

        function showInstallPrompt() {
            const installButton = document.createElement('button');
            installButton.textContent = '📱 Install App';
            installButton.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: linear-gradient(135deg, #2563eb, #1d4ed8);
                color: white;
                border: none;
                padding: 1rem 1.5rem;
                border-radius: 25px;
                font-size: 1rem;
                cursor: pointer;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 1000;
                animation: bounce 2s infinite;
            `;
            
            installButton.onclick = async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    if (outcome === 'accepted') {
                        showNotification('App installed successfully! 🎉');
                    }
                    deferredPrompt = null;
                    installButton.remove();
                }
            };
            
            document.body.appendChild(installButton);
            
            // Auto remove after 10 seconds
            setTimeout(() => {
                if (installButton.parentNode) {
                    installButton.remove();
                }
            }, 10000);
        }

        // Add bounce animation for install button
        const bounceCSS = `
            @keyframes bounce {
                0%, 20%, 50%, 80%, 100% {
                    transform: translateY(0);
                }
                40% {
                    transform: translateY(-10px);
                }
                60% {
                    transform: translateY(-5px);
                }
            }
        `;
        
        const style = document.createElement('style');
        style.textContent = bounceCSS;
        document.head.appendChild(style);

        // Offline Queue Management
        let offlineQueue = [];
        
        function addToOfflineQueue(action, data) {
            offlineQueue.push({
                action,
                data,
                timestamp: Date.now()
            });
            
            // Cache offline queue
            cacheData('offlineQueue', offlineQueue);
        }
        
        function processOfflineQueue() {
            if (isOnline && offlineQueue.length > 0) {
                console.log('Processing offline queue...');
                
                offlineQueue.forEach(item => {
                    switch (item.action) {
                        case 'order':
                            // Process pending order
                            console.log('Processing offline order:', item.data);
                            break;
                        case 'favorite':
                            // Sync favorite items
                            console.log('Syncing favorite:', item.data);
                            break;
                        default:
                            console.log('Unknown offline action:', item.action);
                    }
                });
                
                // Clear queue after processing
                offlineQueue = [];
                cacheData('offlineQueue', offlineQueue);
                
                showNotification('Offline actions processed!');
            }
        }

        // Enhanced Checkout with Offline Support
        function enhancedCheckout() {
            if (cart.length === 0) {
                showNotification('Your cart is empty!', 'error');
                return;
            }
            
            showLoading();
            
            const orderData = {
                items: [...cart],
                total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                timestamp: Date.now()
            };
            
            if (isOnline) {
                // Online checkout
                setTimeout(() => {
                    hideLoading();
                    cart = [];
                    cacheData('cart', cart);
                    updateCartUI();
                    toggleCart();
                    showNotification('Order placed successfully! 🎉');
                    sendPushNotification('Order Confirmed', 'Your order has been placed successfully!');
                }, 2000);
            } else {
                // Offline checkout - add to queue
                addToOfflineQueue('order', orderData);
                
                setTimeout(() => {
                    hideLoading();
                    cart = [];
                    cacheData('cart', cart);
                    updateCartUI();
                    toggleCart();
                    showNotification('Order saved! Will be processed when online. 📱');
                }, 1000);
            }
        }

        // Update the checkout function to use enhanced version
        function checkout() {
            enhancedCheckout();
        }

        // Periodic sync when online
        setInterval(() => {
            if (isOnline) {
                processOfflineQueue();
                syncData();
            }
        }, 30000); // Every 30 seconds

        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            initApp();
            setupBackgroundSync();
            
            // Load offline queue
            const savedQueue = getCachedData('offlineQueue');
            if (savedQueue) {
                offlineQueue = savedQueue;
            }
            
            // Show welcome notification
            setTimeout(() => {
                showNotification('Welcome to ShopPWA! 🛍️');
            }, 1000);
        });

        // Handle app visibility changes
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden && isOnline) {
                // App became visible and online - sync data
                processOfflineQueue();
                syncData();
            }
        });

        // Add keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + K to focus search
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                document.getElementById('searchInput').focus();
            }
            
            // Escape to close cart
            if (e.key === 'Escape') {
                const cartModal = document.getElementById('cartModal');
                if (cartModal.classList.contains('active')) {
                    toggleCart();
                }
            }
        });

        // Add touch gestures for mobile
        let touchStartX = 0;
        let touchStartY = 0;
        
        document.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        });
        
        document.addEventListener('touchend', (e) => {
            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;
            
            const deltaX = touchEndX - touchStartX;
            const deltaY = touchEndY - touchStartY;
            
            // Swipe right to open cart (if swipe is primarily horizontal)
            if (deltaX > 100 && Math.abs(deltaY) < 50) {
                const cartModal = document.getElementById('cartModal');
                if (!cartModal.classList.contains('active')) {
                    toggleCart();
                }
            }
        });

        // Performance monitoring
        function measurePerformance() {
            if ('performance' in window) {
                window.addEventListener('load', () => {
                    const perfData = performance.getEntriesByType('navigation')[0];
                    const loadTime = perfData.loadEventEnd - perfData.fetchStart;
                    console.log(`App loaded in ${loadTime}ms`);
                    
                    // Report to analytics in real app
                    if (loadTime > 3000) {
                        console.warn('Slow loading detected');
                    }
                });
            }
        }

        measurePerformance();
    </script>
</body>
</html>